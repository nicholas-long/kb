# active directory domain
- create username list with different formats to identify usernames
- sensitive content in file shares
- kerbrute
  - user enum
  - password spray
    - sync time before password spray! `ntpdate`; VM -> stop time sync with host or spray with CME
  - brute force
- crackmapexec
  - SMB
  - WinRM
  - MSSQL
  - other services exposed
- unauthenticated ASREP roast with usernames list
- retry credentials for every service
- discover common temporary password -> spray
- relay NTLMv2 hashes to other machines that have no SMB signing
- authenticated ( probably ) lateral movement
  - impacket
    - roasting SPN service accounts
    - ASREP roast no preauth users
    - get AD users - any authenticated user
      - check notes/description of LDAP data for leaked passwords
    - impacket-findDelegation (bloodhound checks this too)
  - bloodhound
    - run python version bloodhound.py in docker
    - paths in bloodhound
    - queries on json data
      - users - description, password last set, last login & timestamp
      - computers - OS
  - add dc hostname and machine name to hosts file if this can't authenticate
  - command execution but no creds -> use privs granted by running on machine
    - get NTLMv2 hash to crack
    - run sharphound on target
    - kerberoast from target ( mimikatz? )
  - list and impersonate tokens on compromised hosts ( meterpreter incognito )
    - reuse sessions `New-PSSession -Computer ComputerHostname` to other hosts / DC
- derivitive local admins on workstations / servers
- enumerate sessions with powerview
- enumerate tickets
  - klist
  - other users tickets as admin with mimikatz
- got NTLM hash
  - pass the hash
  - NTLM -> run process as user with mimikatz `sekurlsa::pth` "over pass the hash"
    - `net use \\dchostname`, then get cached kerberos tickets
- CYCLE - reuse credentials, access services, abuse access, get more credentials
- target users who might have simple passwords ( bloodhound data, ldap? )
  - users that have not logged in `.lastlogontimestamp == -1`
  - users who had password changed and have not logged in since `.pwdlastset > .lastlogontimestamp`
- common exploits
  - headline exploits
    - 2021 - nopac attack `sam the admin` on github, then psexec
    - 2020 - zerologon
    - 2022 relay DC attack CVE-2022-26925 variation of petitpotam
  - ticket attacks
    - silver ticket to domain admin CVE-2014-6324
  - cached GPP KB2928120 (see MS14-025), some Group Policy Prefs configured with account in XML
- have local admin and office installed and remote ports 135,445 -> DCOM lateral movement excel remote macro
- endgame dump hashes
  - impacket secretsdump
  - mimikatz on machine or kiwi module in msf

## powershell web access
- try logins manually - find tool?
- "not authorized" -> try changing computer name because error msg should say "sign-in failed"
